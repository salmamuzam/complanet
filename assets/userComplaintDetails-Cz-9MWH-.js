import{s as f}from"./darkMode-B-Ivf8oh.js";document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("loadingState"),document.getElementById("errorState"),document.getElementById("contentState");const{data:{session:e}}=await f.auth.getSession();if(!e){window.location.href="Login.html";return}const o=new URLSearchParams(window.location.search).get("id");if(!o){u();return}try{const{data:t,error:a}=await f.from("complaint").select(`
                *,
                category:categoryid (categoryname),
                complaintattachment (*)
            `).eq("complaintid",o).eq("complainantid",e.user.id).single();if(a||!t){console.error("Error fetching complaint:",a),u();return}x(t),b(o,t.category?.categoryname)}catch(t){console.error("Unexpected error:",t),u()}});async function b(e,i){const t={Academic:"academiccomplaint",Facility:"facilitycomplaint",Administrative:"administrativecomplaint","Student Disciplinary":"studentbehaviorcomplaint",Technical:"technicalcomplaint",Other:"othercomplaint"}[i];if(t)try{const{data:a,error:d}=await f.from(t).select("*").eq("complaintid",e).maybeSingle();if(d||!a){console.log(`No specific details found for ${i}`);return}v(i,a)}catch(a){console.error("Error fetching specific details:",a)}}function v(e,i){const o=document.getElementById("specificDetailsContainer"),t=document.getElementById("specificDetailsSection");o.innerHTML="";const a={lecturername:"Lecturer Name",batchcode:"Batch Code",modulename:"Module Name",currentlevel:"Current Level",semester:"Semester",specificationofissue:"Specific Issue",phone:"Contact Phone",typeoffacility:"Facility Type",typeoffacilityissue:"Nature of Issue",facilityfloor:"Floor / Level",complaintdepartment:"Department",staffinvolved:"Staff Involved",accusedname:"Involved Student(s)",typeofbehavior:"Behavior Type",locationofincident:"Location",witnessdetail:"Witness Details",typeofissue:"Technical Problem",deviceaffected:"Device / Software",previousattempt:"Previous Attempts",desiredoutcome:"Desired Outcome",suggestedcategory:"Suggested Category"};let d=!1;for(const[c,m]of Object.entries(i)){if(c==="complaintid"||c==="id"||!m||m==="null")continue;const p=a[c]||c.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase()),s=document.createElement("div");s.className="flex flex-col sm:flex-row sm:items-start border-b border-gray-100 dark:border-gray-700 pb-2",s.innerHTML=`
            <span class="w-40 flex-shrink-0 font-semibold text-gray-500 dark:text-gray-400 capitalize">${p}:</span>
            <span class="text-gray-900 dark:text-gray-200">${m}</span>
        `,o.appendChild(s),d=!0}d&&t.classList.remove("hidden")}function x(e){const i=document.getElementById("loadingState"),o=document.getElementById("contentState");document.getElementById("complaintTitle").textContent=e.complainttitle,document.getElementById("complaintDesc").textContent=e.complaintdescription,document.getElementById("complaintId").textContent=e.complaintid;const t=new Date(e.submitteddate);if(document.getElementById("submittedDate").textContent=t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),e.dateofincident){const r=new Date(e.dateofincident),n=document.createElement("p");n.className="text-gray-500 dark:text-gray-400 text-sm mt-1",n.innerHTML=`<i class="fas fa-exclamation-circle mr-1 text-amber-500"></i> Date of Incident: <span>${r.toLocaleDateString()}</span>`,document.getElementById("complaintTitle").parentElement.appendChild(n)}const a=document.getElementById("categoryBadge");a.textContent=e.category?.categoryname||"Other";const c={Facility:"#009688",Academic:"#6366f1",Administrative:"#ec4899","Student Disciplinary":"#ef4444",Technical:"#14b8a6",Other:"#64748b"}[e.category?.categoryname]||"#64748b";a.style.background=c,[document.querySelector("#specificDetailsSection h3 i"),document.querySelector("section h3 i.fa-align-left"),document.querySelector("#attachmentsSection h3 i")].forEach(r=>{r&&(r.style.color=c,r.classList.remove("text-blue-500"))});const s={Pending:{color:"var(--color-pending)",icon:"fas fa-clock",bg:"rgba(231, 76, 60, 0.1)"},"In-Progress":{color:"var(--color-progress)",icon:"fas fa-spinner fa-spin",bg:"rgba(241, 196, 15, 0.1)"},Resolved:{color:"var(--color-resolved)",icon:"fas fa-check-circle",bg:"rgba(46, 204, 113, 0.1)"},Deleted:{color:"#dc3545",icon:"fas fa-trash-alt",bg:"rgba(220, 53, 69, 0.1)"}}[e.complaintstatus]||{color:"#999",icon:"fas fa-question-circle",bg:"#f0f0f0"},g=document.getElementById("statusBadge");g.style.color=s.color,g.style.backgroundColor=s.bg,document.getElementById("statusIcon").className=s.icon,document.getElementById("statusText").textContent=e.complaintstatus,e.admin_feedback&&(document.getElementById("adminFeedbackSection").classList.remove("hidden"),document.getElementById("adminFeedback").textContent=e.admin_feedback);const y=e.complaintattachment||[];if(y.length>0){document.getElementById("attachmentsSection").classList.remove("hidden");const r=document.getElementById("attachmentsContainer");r.innerHTML="",y.forEach(n=>{const h=n.fileurl.match(/\.(jpeg|jpg|gif|png|webp)/i),l=document.createElement("a");l.href=n.fileurl,l.target="_blank",h?(l.className="block bg-white dark:bg-gray-900 rounded-3xl overflow-hidden border border-gray-100 dark:border-gray-700 hover:shadow-xl transition-all duration-300 group",l.innerHTML=`
                    <div class="aspect-video w-full overflow-hidden bg-gray-100 dark:bg-gray-800">
                        <img src="${n.fileurl}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <div class="truncate">
                            <p class="text-sm font-bold text-gray-900 dark:text-white truncate">${n.filename||"Evidence Photo"}</p>
                            <p class="text-xs text-gray-500 truncate">${n.description||"View full image"}</p>
                        </div>
                        <i class="fas fa-expand-alt text-gray-300 group-hover:text-blue-500"></i>
                    </div>
                `):(l.className="flex items-center p-5 bg-gray-50 dark:bg-gray-900 rounded-2xl border border-gray-100 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 transition shadow-sm group",l.innerHTML=`
                    <div class="flex-shrink-0 w-12 h-12 bg-white dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700 flex items-center justify-center mr-4">
                        <i class="fas fa-file-pdf text-red-500 text-2xl"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-bold text-gray-900 dark:text-white truncate group-hover:text-blue-500 transition">${n.filename||"Document"}</p>
                        <p class="text-xs text-gray-500 truncate">${n.description||"Open attachment"}</p>
                    </div>
                    <i class="fas fa-external-link-alt text-gray-300 group-hover:text-blue-500 transition ml-2"></i>
                `),r.appendChild(l)})}i.classList.add("hidden"),o.classList.remove("hidden")}function u(){document.getElementById("loadingState").classList.add("hidden"),document.getElementById("errorState").classList.remove("hidden")}
