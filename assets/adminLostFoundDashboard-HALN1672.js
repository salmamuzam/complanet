import{s as r}from"./darkMode-B-Ivf8oh.js";let u=null,m=[];document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:e}}=await r.auth.getSession();if(!e){window.location.href="Login.html";return}g(),L(),v()});window.navigateToComplaints=function(e){e?window.location.href=`AllComplaints.html?status=${e}`:window.location.href="AllComplaints.html"};async function g(){const{data:{session:e}}=await r.auth.getSession();if(!e){alert("You are not logged in. Redirecting to login page..."),window.location.href="Login.html";return}const{data:t,error:o}=await r.from("admin").select("id, adminfirstname, adminlastname, adminrole, profile_pic").eq("id",e.user.id).single();if(o||!t){alert("Access denied. You are not an admin."),window.location.href="Login.html";return}t.id,u=t.adminrole;const n=document.getElementById("welcomeTitle"),i=document.getElementById("welcomeSubtitle");n&&(n.textContent=`Welcome, ${t.adminfirstname} ${t.adminlastname}`),i&&(i.textContent=`${t.adminrole} Dashboard â€” Manage and monitor all ${t.adminrole.toLowerCase()} complaints assigned to you.`);const a=document.getElementById("profileButton");a&&t.profile_pic&&(a.innerHTML=`
            <img src="${t.profile_pic}" alt="Profile" class="h-10 w-10 rounded-full object-cover">
        `);const l=document.getElementById("navAllComplaints"),s=document.getElementById("navLostFound"),d=document.getElementById("mobileNavAllComplaints"),c=document.getElementById("mobileNavLostFound");l&&(l.style.display="block"),s&&(s.style.display="block"),d&&(d.style.display="block"),c&&(c.style.display="block"),u==="LostAndFound Admin"?(l&&(l.style.display="none"),d&&(d.style.display="none"),s&&(s.style.display="block"),c&&(c.style.display="block")):u==="Master Admin"||(s&&(s.style.display="none"),c&&(c.style.display="none")),p()}async function p(){try{let e=r.from("lost_and_found").select("*");const{data:t,error:o}=await e.order("created_at",{ascending:!1});if(o){console.error("Error fetching lost items:",o);return}m=t||[],h(m);const n=m.filter(i=>i.status!=="Deleted");C(n.slice(0,5))}catch(e){console.error("Unexpected error loading lost items:",e)}}function h(e){const t=e.length,o=e.filter(l=>l.status==="Lost").length,n=e.filter(l=>l.status==="Claim").length,i=e.filter(l=>l.status==="Found").length,a=e.filter(l=>l.status==="Deleted").length;document.getElementById("totalCount").textContent=t,document.getElementById("lostCount").textContent=o,document.getElementById("claimCount").textContent=n,document.getElementById("foundCount").textContent=i,document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=a)}function C(e){const t=document.getElementById("recentActivityTable"),o=document.getElementById("recentActivityCards");if(t&&(t.textContent=""),o&&(o.textContent=""),e.length===0){t&&(t.innerHTML='<tr><td colspan="5" class="py-6 text-center text-gray-500">No recent activity found.</td></tr>'),o&&(o.innerHTML='<p class="text-center text-gray-500 py-4">No recent activity found.</p>');return}e.forEach(n=>{const i=new Date(n.created_at||n.reported_date).toLocaleDateString();let a="bg-gray-200 text-gray-700";if(n.status==="Lost"?a="bg-red-100 text-red-700":n.status==="Claim"?a="bg-yellow-100 text-yellow-700":n.status==="Found"?a="bg-green-100 text-green-700":n.status==="Deleted"&&(a="bg-gray-200 text-gray-600"),t){const l=document.getElementById("recentActivityRowTemplate");if(l){const s=l.content.cloneNode(!0);s.querySelector("tr"),s.querySelector(".col-title").textContent=n.item_name||"Unnamed Item",s.querySelector(".col-category").textContent=n.item_type||"Unknown",s.querySelector(".col-date").textContent=i;const d=s.querySelector(".col-status");d.textContent=n.status,d.className=`col-status py-1 px-3 rounded-full text-xs font-semibold ${a}`;const c=s.querySelector(".col-link");c.href=`AdminLostFoundDetails.html?id=${n.item_id}`,t.appendChild(s)}}if(o){const l=document.getElementById("activityCardTemplate");if(l){const d=l.content.cloneNode(!0).querySelector("div");d.querySelector(".card-title").textContent=n.item_name||"Unnamed Item";const c=d.querySelector(".card-status");c.textContent=n.status,c.className=`card-status py-1 px-2 rounded text-[10px] font-bold uppercase tracking-wide whitespace-nowrap ml-2 ${a}`,d.querySelector(".card-category").textContent=n.item_type||"Unknown",d.querySelector(".card-date").textContent=i;const y=d.querySelector(".card-link");y.href=`AdminLostFoundDetails.html?id=${n.item_id}`,o.appendChild(d)}}})}function L(){const e=document.getElementById("headerLogoutBtn");e&&e.addEventListener("click",f);const t=document.getElementById("logoutModal");if(t){const n=document.getElementById("cancelLogoutBtn"),i=document.getElementById("confirmLogoutBtn");n&&n.addEventListener("click",()=>{t.classList.add("hidden")}),i&&i.addEventListener("click",async()=>{const{error:a}=await r.auth.signOut();a&&console.error("Error signing out:",a),window.location.href="Login.html"}),t.addEventListener("click",a=>{a.target===t&&t.classList.add("hidden")})}const o=setInterval(()=>{const n=document.querySelector('#mobileMenu a[href="Login.html"]');if(n)n.addEventListener("click",f),clearInterval(o);else if(document.readyState==="complete"){const i=document.querySelector('#mobileMenu a[href="Login.html"]');i&&i.addEventListener("click",f),clearInterval(o)}},100)}function f(e){e&&e.preventDefault();const t=document.getElementById("logoutModal");t&&t.classList.remove("hidden")}function v(){const e=document.getElementById("adminNotepad"),t=document.getElementById("saveStatus");if(!e)return;const o=localStorage.getItem("admin_scratchpad_notes");o&&(e.value=o);let n;e.addEventListener("input",()=>{t.textContent="Saving...",clearTimeout(n),n=setTimeout(()=>{localStorage.setItem("admin_scratchpad_notes",e.value),t.textContent="Auto-saved",t.classList.add("text-green-600","dark:text-green-400"),setTimeout(()=>{t.classList.remove("text-green-600","dark:text-green-400")},1e3)},500)})}
