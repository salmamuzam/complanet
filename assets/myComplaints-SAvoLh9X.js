import{s as h}from"./darkMode-B-Ivf8oh.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:C}}=await h.auth.getSession();if(!C){window.location.href="Login.html";return}const k=C.user,c=document.getElementById("tabComplaints"),l=document.getElementById("tabLostFound"),S=document.getElementById("sectionComplaints"),E=document.getElementById("sectionLostFound"),f=document.getElementById("complaintList"),w=document.getElementById("statusFilter"),I=document.getElementById("categoryFilter"),q=document.getElementById("dateSort"),i=document.getElementById("lostItemsList"),D=document.getElementById("lostStatusFilter");let r=[],d=[];const F={Facility:"#009688",Academic:"#8e44ad",Administrative:"#ff9800","Student Disciplinary":"#e91e63",Technical:"#007bff",Other:"#607d8b"},T={Pending:{color:"var(--color-pending)",icon:"â³"},"In-Progress":{color:"var(--color-progress)",icon:"ðŸ”§"},Resolved:{color:"var(--color-resolved)",icon:"âœ…"},Deleted:{color:"#dc3545",icon:"ðŸ—‘ï¸"}},_={Lost:{color:"#ff9800",icon:"â“",text:"Lost"},Claim:{color:"#2196f3",icon:"ðŸ‘€",text:"Match Found (Visit Admin)"},Found:{color:"#4caf50",icon:"âœ…",text:"Returned / Found"},Deleted:{color:"#f44336",icon:"ðŸ—‘ï¸",text:"Deleted"}};function L(e){e==="lostfound"?(l.classList.add("border-[var(--color-eco)]","text-eco-dark","dark:text-blue-400","font-semibold"),l.classList.remove("border-transparent","text-gray-500","dark:text-gray-400","font-medium","hover:text-gray-700","dark:hover:text-gray-300"),c.classList.remove("border-[var(--color-eco)]","text-eco-dark","dark:text-blue-400","font-semibold"),c.classList.add("border-transparent","text-gray-500","dark:text-gray-400","font-medium","hover:text-gray-700","dark:hover:text-gray-300"),E.classList.remove("hidden"),S.classList.add("hidden"),$()):(c.classList.add("border-[var(--color-eco)]","text-eco-dark","dark:text-blue-400","font-semibold"),c.classList.remove("border-transparent","text-gray-500","dark:text-gray-400","font-medium","hover:text-gray-700","dark:hover:text-gray-300"),l.classList.remove("border-[var(--color-eco)]","text-eco-dark","dark:text-blue-400","font-semibold"),l.classList.add("border-transparent","text-gray-500","dark:text-gray-400","font-medium","hover:text-gray-700","dark:hover:text-gray-300"),S.classList.remove("hidden"),E.classList.add("hidden"),B())}c.addEventListener("click",()=>L("complaints")),l.addEventListener("click",()=>L("lostfound")),new URLSearchParams(window.location.search).get("tab")==="lostfound"?L("lostfound"):B();async function B(){const{data:e,error:n}=await h.from("complaint").select(`
        complaintid,
        complainttitle,
        complaintdescription,
        complaintstatus,
        submitteddate,
        complainantid,
        admin_feedback,
        category:categoryid (categoryname)
      `).eq("complainantid",k.id).order("submitteddate",{ascending:!1});if(n){console.error(n),f.innerHTML="<p class='text-center text-red-500'>Failed to load complaints.</p>";return}r=e,g(r)}function g(e){if(f.replaceChildren(),!e||e.length===0){f.innerHTML="<p class='text-center text-gray-500 py-6'>No Complaints Found</p>";return}const n=document.getElementById("complaintCardTemplate");e.forEach(t=>{if(!n)return;const o=n.content.cloneNode(!0),a=o.querySelector("div"),s=T[t.complaintstatus]||{color:"#999",icon:"âšª"};a.style.borderLeft=`5px solid ${s.color}`,o.querySelector(".title").textContent=t.complainttitle,o.querySelector(".desc").textContent=t.complaintdescription;const p=o.querySelector(".category-badge");p.textContent=t.category?.categoryname||"Other",p.style.background=F[t.category?.categoryname]||"#555";const m=o.querySelector(".status-badge");m.innerHTML=`${s.icon} ${t.complaintstatus}`,m.style.color=s.color;const u=o.querySelector(".admin-feedback");t.admin_feedback&&(u.classList.remove("hidden"),u.querySelector(".feedback-text").textContent=t.admin_feedback),o.querySelector(".submitted-date").textContent=`Submitted: ${new Date(t.submitteddate).toLocaleDateString()}`,a.addEventListener("click",()=>{window.location.href=`UserComplaintDetails.html?id=${t.complaintid}`}),f.appendChild(o)})}async function $(){i.innerHTML="<p class='text-center text-gray-500 py-6'>Loading...</p>";const{data:e,error:n}=await h.from("lost_and_found").select("*").eq("user_id",k.id).order("reported_date",{ascending:!1});if(n){console.error(n),i.innerHTML="<p class='text-center text-red-500'>Failed to load items.</p>";return}d=e,x(d)}function x(e){if(i.replaceChildren(),!e||e.length===0){i.innerHTML="<p class='text-center text-gray-500 py-6'>No Lost Items Reported</p>";return}const n=document.getElementById("lostItemCardTemplate");e.forEach(t=>{if(!n)return;const o=n.content.cloneNode(!0),a=o.querySelector("div"),s=_[t.status]||_.Lost;a.style.borderLeft=`5px solid ${s.color}`;const p=t.date_lost?new Date(t.date_lost).toLocaleDateString():"Unknown Date";o.querySelector(".item-name").textContent=t.item_name,o.querySelector(".location").textContent=t.location_lost,o.querySelector(".date").textContent=p;const m=o.querySelector(".item-desc");t.description&&(m.classList.remove("hidden"),m.textContent=t.description),o.querySelector(".type-badge").textContent=t.item_type;const u=o.querySelector(".status-badge");if(u.innerHTML=`${s.icon} ${s.text}`,u.style.color=s.color,t.brand||t.primary_color){const y=o.querySelector(".item-details");y.classList.remove("hidden");const v=[];t.brand&&v.push(`Brand: ${t.brand}`),t.primary_color&&v.push(`Color: ${t.primary_color}`),y.textContent=v.join(" â€¢ ")}if(t.admin_feedback){const y=o.querySelector(".admin-feedback");y.classList.remove("hidden"),y.querySelector(".feedback-text").textContent=t.admin_feedback}a.addEventListener("click",()=>{window.location.href=`UserLostFoundDetails.html?id=${t.item_id}`}),i.appendChild(o)})}w.addEventListener("change",()=>{const e=w.value,n=e==="all"?r:r.filter(t=>t.complaintstatus===e);g(n)}),I.addEventListener("change",()=>{const e=I.value,n=e==="all"?r:r.filter(t=>t.category?.categoryname===e);g(n)}),q.addEventListener("change",()=>{const e=q.value;r.sort((n,t)=>{const o=new Date(n.submitteddate),a=new Date(t.submitteddate);return e==="newest"?a-o:o-a}),g(r)});const b=document.getElementById("lostDateSort");b&&b.addEventListener("change",()=>{const e=b.value;d.sort((n,t)=>{const o=new Date(n.reported_date),a=new Date(t.reported_date);return e==="newest"?a-o:o-a}),x(d)}),D.addEventListener("change",()=>{const e=D.value,n=e==="all"?d:d.filter(t=>t.status===e);x(n)})});
