import{s as d}from"./darkMode-B-Ivf8oh.js";import"./notifications-UIo-hPC3.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:i}}=await d.auth.getSession();if(!i){window.location.href="Login.html";return}try{const c=i.user.id,{data:s,error:m}=await d.from("users").select("first_name, last_name").eq("id",c).single();if(m||!s)console.error("Error fetching user data:",m),document.getElementById("welcomeUsername").textContent="Welcome!";else{const{first_name:r,last_name:p}=s;document.getElementById("welcomeUsername").textContent=`Welcome, ${r} ${p}!`}const{data:e,error:n}=await d.from("complaint").select("complaintstatus").eq("complainantid",c);if(n){console.error("Error fetching complaints:",n);return}let u=0,a=0,t=0,l=0;e.forEach(r=>{switch(r.complaintstatus){case"Pending":u++;break;case"In-Progress":a++;break;case"Resolved":t++;break;case"Deleted":l++;break}}),document.getElementById("pendingCount").textContent=u,document.getElementById("inProgressCount").textContent=a,document.getElementById("resolvedCount").textContent=t,document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=l)}catch(o){console.error("Unexpected error:",o),alert("Something went wrong! Check console.")}});async function g(){const{data:{user:i}}=await d.auth.getUser();if(!i)return;const{data:o,error:c}=await d.from("complaint").select(`
      complaintid,
      complainttitle,
      complaintdescription,
      complaintstatus,
      submitteddate,
      category:categoryid ( categoryname )
    `).eq("complainantid",i.id).order("submitteddate",{ascending:!1}).limit(5);if(c){console.error("Error fetching complaints:",c);return}const s=document.getElementById("recentComplaintsContainer"),m=document.getElementById("complaintCardTemplate");if(s.innerHTML="",!o||o.length===0){s.innerHTML='<p class="text-gray-500 text-sm">No complaints found.</p>';return}o.forEach(e=>{const n=m.content.cloneNode(!0),u=n.querySelector(".complaint-card");n.querySelector(".title").textContent=e.complainttitle,n.querySelector(".description").textContent=e.complaintdescription;const a=n.querySelector(".status");a.textContent=e.complaintstatus,e.complaintstatus==="Pending"?a.classList.add("bg-yellow-100","text-yellow-700"):e.complaintstatus==="In-Progress"?a.classList.add("bg-blue-100","text-blue-700"):e.complaintstatus==="Resolved"?a.classList.add("bg-green-100","text-green-700"):e.complaintstatus==="Deleted"&&a.classList.add("bg-red-100","text-red-700");const t=document.createElement("span");t.classList.add("px-3","py-1","text-xs","font-semibold","rounded-full");const l=e.category?.categoryname||"Other";switch(t.textContent=l,l){case"Facility":t.classList.add("bg-purple-100","text-purple-700");break;case"Academic":t.classList.add("bg-indigo-100","text-indigo-700");break;case"Administrative":t.classList.add("bg-pink-100","text-pink-700");break;case"Student Disciplinary":t.classList.add("bg-red-100","text-red-700");break;case"Technical":t.classList.add("bg-teal-100","text-teal-700");break;default:t.classList.add("bg-gray-100","text-gray-700")}n.querySelector(".footer").appendChild(t);const r=new Date(e.submitteddate);n.querySelector(".date").textContent=r.toLocaleDateString()+" "+r.toLocaleTimeString(),u.addEventListener("click",()=>{window.location.href=`UserComplaintDetails.html?id=${e.complaintid}`}),s.appendChild(n)})}g();
