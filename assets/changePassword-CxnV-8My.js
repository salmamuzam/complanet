import{s as t}from"./darkMode-B-Ivf8oh.js";document.addEventListener("DOMContentLoaded",async()=>{const f=document.getElementById("changePasswordForm"),c=document.getElementById("newPassword"),d=document.getElementById("confirmPassword"),i=document.getElementById("toggleNewPassword"),l=document.getElementById("toggleConfirmPassword"),y=document.getElementById("eyeIconNew"),p=document.getElementById("eyeOffIconNew"),E=document.getElementById("eyeIconConfirm"),P=document.getElementById("eyeOffIconConfirm");function m(o,e,s){o.type==="password"?(o.type="text",e.classList.remove("hidden"),s.classList.add("hidden")):(o.type="password",e.classList.add("hidden"),s.classList.remove("hidden"))}i&&i.addEventListener("click",()=>{m(c,y,p)}),l&&l.addEventListener("click",()=>{m(d,E,P)});const I=window.location.hash.substring(1),w=new URLSearchParams(I),n=w.get("error_description"),L=w.get("error_code");n&&(alert(`Error: ${n}`),console.error("Supabase error:",L,n)),new URLSearchParams(window.location.search).get("code");const u=new URLSearchParams(window.location.search),h=u.has("code"),r=window.location.hash,v=r.includes("access_token")||r.includes("type=recovery"),C=r.includes("error="),{data:{session:S}}=await t.auth.getSession();if(!S&&!h&&!v&&!C){window.location.href="Login.html";return}if(h){const{data:o,error:e}=await t.auth.exchangeCodeForSession(u.get("code"));if(e){console.error("Exchange code error:",e),alert("Invalid or expired link: "+e.message),window.location.href="Login.html";return}else console.log("PKCE Session established")}const g=document.getElementById("mainContent");g&&g.classList.remove("hidden"),t.auth.onAuthStateChange((o,e)=>{o==="PASSWORD_RECOVERY"&&console.log("Password recovery mode active. Session:",e)}),f.addEventListener("submit",async o=>{o.preventDefault();const e=c.value.trim(),s=d.value.trim();if(!e||e.length<6){alert("Password must be at least 6 characters.");return}if(e!==s){alert("Passwords do not match. Please try again.");return}const{data:{session:B}}=await t.auth.getSession();if(!B){alert("Session invalid or expired. Please request a new password reset link.");return}const{data:k,error:a}=await t.auth.updateUser({password:e});if(a){alert("Error updating password: "+a.message),console.error(a);return}alert("Password updated successfully!"),window.location.href="Login.html"})});
