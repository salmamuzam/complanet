import{s as l}from"./darkMode-B-Ivf8oh.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:L}}=await l.auth.getSession();if(!L){window.location.href="Login.html";return}const p=new URLSearchParams(window.location.search).get("id");if(!p){alert("No found item ID provided"),window.location.href="AdminLostFound.html";return}await x(p),N();async function x(c){try{const{data:e,error:t}=await l.from("found_items").select("*").eq("found_item_id",c).single();if(t)throw t;console.log("Found item loaded:",e);let d=null;try{const{data:o,error:m}=await l.from("admin").select("adminfirstname, adminlastname, adminrole, profile_pic").eq("id",e.admin_id).single();m?console.error("Admin fetch error:",m):d=o;const i=document.getElementById("profileButton");i&&o.profile_pic&&(i.innerHTML=`
                        <img src="${o.profile_pic}" alt="Profile" class="h-10 w-10 rounded-full object-cover">
                    `)}catch(o){console.error("Admin fetch failed:",o)}const{data:n,error:r}=await l.from("lost_found_attachments").select("*").eq("found_item_id",c);r&&console.error("Attachments error:",r),document.getElementById("databaseId").textContent=e.found_item_id,document.getElementById("itemName").textContent=e.item_name||"N/A",document.getElementById("itemTypeDisplay").textContent=e.item_type||"N/A";const a=document.getElementById("statusBadge");if(a.textContent=e.status,e.status==="Unclaimed"?a.className="px-4 py-1.5 rounded-full text-sm font-bold bg-yellow-100 text-yellow-800 shadow-md":e.status==="Claimed"&&(a.className="px-4 py-1.5 rounded-full text-sm font-bold bg-green-100 text-green-800 shadow-md"),document.getElementById("uploadedDate").textContent=e.created_at?new Date(e.created_at).toLocaleDateString():"N/A",document.getElementById("dateFound").textContent=e.date_found?new Date(e.date_found).toLocaleDateString():"N/A",document.getElementById("timeFound").textContent=e.time_found||"N/A",document.getElementById("locationFound").textContent=e.location_found||"N/A",document.getElementById("brand").textContent=e.brand||"--",document.getElementById("model").textContent=e.model||"--",document.getElementById("serialNumber").textContent=e.serial_number||"--",document.getElementById("primaryColor").textContent=e.primary_color||"--",document.getElementById("secondaryColor").textContent=e.secondary_color||"--",document.getElementById("distFeatures").textContent=e.distinguishing_features||"None specified",document.getElementById("description").textContent=e.description||"No description provided",d){const o=`${d.adminfirstname||""} ${d.adminlastname||""}`.trim()||"Unknown Admin";document.getElementById("adminName").textContent=`${o} (${d.adminrole||"Admin"})`;const m=`${d.adminfirstname?.[0]||""}${d.adminlastname?.[0]||""}`.toUpperCase()||"A";document.getElementById("adminInitials").textContent=m}else document.getElementById("adminName").textContent="Admin Info Unavailable",document.getElementById("adminInitials").textContent="A";if(n&&n.length>0){const o=document.getElementById("imageContainer");o.innerHTML="",n.forEach(m=>{const i=document.createElement("img");i.src=m.file_url,i.alt="Found Item Image",i.className="h-48 w-auto rounded-lg border-2 border-gray-200 dark:border-gray-700 object-cover cursor-pointer hover:scale-105 transition-transform",i.onclick=()=>window.open(m.file_url,"_blank"),o.appendChild(i)})}e.status==="Claimed"&&e.matched_lost_item_id&&await w(e.matched_lost_item_id,e.claim_date)}catch(e){console.error("Error loading found item:",e),alert("Failed to load found item details"),window.location.href="AdminLostFound.html"}}async function w(c,e){try{const{data:t,error:d}=await l.from("lost_and_found").select("item_id, item_name, item_type, location_lost, reported_date, user_id").eq("item_id",c).single();if(d||!t){console.error("Error loading matched lost item:",d);return}const{data:n,error:r}=await l.from("users").select("id, first_name, last_name, email, profile_image_url").eq("id",t.user_id).single();r&&console.error("Error loading reporter:",r);const a=document.getElementById("matchedLostItemCard");a&&a.classList.remove("hidden");const o=document.getElementById("matchedLostId");o&&(o.textContent=t.item_id);const m=document.getElementById("matchedLostItemName");m&&(m.textContent=t.item_name||"N/A");const i=document.getElementById("matchedLostItemType");i&&(i.textContent=t.item_type||"N/A");const y=document.getElementById("matchedLostLocation");if(y&&(y.textContent=t.location_lost||"N/A"),n){const g=`${n.first_name||""} ${n.last_name||""}`.trim()||"Unknown User",h=`${n.first_name?.[0]||"U"}${n.last_name?.[0]||""}`.toUpperCase(),s=document.getElementById("matchedReporterName");s&&(s.textContent=g);const u=document.getElementById("matchedReporterEmail");u&&(u.textContent=n.email||"N/A");const B=document.getElementById("matchedReporterId");B&&(B.textContent=n.id);const C=document.getElementById("matchedReporterInitials");C&&(C.textContent=h);const f=document.getElementById("matchedReporterProfilePic"),I=document.getElementById("matchedReporterInitials");n.profile_image_url&&f&&I?(f.src=n.profile_image_url,f.classList.remove("hidden"),I.classList.add("hidden")):I&&(I.classList.remove("hidden"),f&&f.classList.add("hidden"))}else{const g=document.getElementById("matchedReporterName");g&&(g.textContent="Unknown User");const h=document.getElementById("matchedReporterEmail");h&&(h.textContent="N/A");const s=document.getElementById("matchedReporterId");s&&(s.textContent=t.user_id);const u=document.getElementById("matchedReporterInitials");u&&(u.textContent="U")}const E=document.getElementById("matchedReportedDate");E&&(E.textContent=t.reported_date?new Date(t.reported_date).toLocaleDateString():"N/A");const _=document.getElementById("matchedDateReceived");_&&(_.textContent=e?new Date(e).toLocaleDateString():"N/A")}catch(t){console.error("Error fetching matched lost item:",t)}}function N(){const c=document.getElementById("mobileMenuButton"),e=document.getElementById("mobileMenu");c&&e&&c.addEventListener("click",()=>{e.classList.toggle("-translate-x-full")});const t=document.getElementById("profileButton"),d=document.getElementById("profileMenu");t&&d&&(t.addEventListener("click",a=>{a.stopPropagation(),d.classList.toggle("hidden")}),document.addEventListener("click",a=>{!t.contains(a.target)&&!d.contains(a.target)&&d.classList.add("hidden")}));const n=document.getElementById("headerLogoutBtn"),r=document.getElementById("logoutModal");if(n&&r){n.addEventListener("click",()=>r.classList.remove("hidden"));const a=document.getElementById("cancelLogoutBtn"),o=document.getElementById("confirmLogoutBtn");a&&(a.onclick=()=>r.classList.add("hidden")),o&&(o.onclick=async()=>{await l.auth.signOut(),window.location.href="Login.html"})}}});
